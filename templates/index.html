<html>


<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/navbars/">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/body.css') }}">
    
</head>

<body>


	<div class="container" id='container'>
		<nav class="navbar navbar-expand-lg rounded" aria-label="Eleventh navbar example">
		  <div class="container-fluid">
			<a class="navbar-brand" href="#">Menu</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample09" aria-controls="navbarsExample09" aria-expanded="false" aria-label="Toggle navigation">
			  <span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarsExample09">
			  <ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item active">
				  <a class="nav-link" aria-current="page" href="/">Home</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link" href="/alerts">Alerts</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link" href="/preview_whitelist">Whitelist</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link" href="/previewBlacklist">Blacklist</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link" href="/previewRules" tabindex="-1">Rules</a>
				</li>
				<li class="nav-item">
				  <a class="nav-link" href="/register" tabindex="-1">Register</a>
				</li>
			  </ul>
			</div>
		  </div>
		</nav>
	</div>
	

	<div class='modal' id='modal'>
	</div>


	<div class="edit" id="edit">
		<div class="edit_top" id="edit_top">
			<button  onclick="hide()" class='edit_top_button'>X</button>
		</div>
		<div class="edit_left" id="edit_left">

		</div>
		<div class="edit_right" id="edit_right">

		</div>
	</div>


	<div class="content">
	
		<div class="forthbox" id="forth">
			<div class='risk_box'>
			Risk assessment 
			<br>
				<div class="alert_box" id='alert1'>
					<div class='alert_box_text'>
						Low</div>
						<br>
						<div id='counter1'>0</div>
					
				</div>
				<div class="alert_box" id='alert2'>
					<div class='alert_box_text'>
						Medium</div><br>
						<div id='counter2'>0</div>
				</div>
				<div class="alert_box" id='alert3'>
					<div class='alert_box_text'>
						High</div><br>
						<div id='counter3'>0</div>
				</div>
			</div>
			

			<div class='details_box'>
				Whitelist status
				<br>
				<div class="alert_box" id='alert1'>
					<div class='alert_box_text'>
						Domains</div>
						<br>
						<div id='counter4'>0</div>
					
				</div>
				<div class="alert_box" id='alert2'>
					<div class='alert_box_text'>
						User-Agents</div><br>
						<div id='counter5'>0</div>
				</div>
				<div class="alert_box" id='alert3'>
					<div class='alert_box_text'>
						Sources</div><br>
						<div id='counter6'>0</div>
				</div>
			</div>
		</div>


		<div class="firstfloatbox" id="first">
			<div class="progressbar2">
			 {{numar[0]}}/{{numar[-1]}}
			 <span style="float: left">ICMP</span>
			 <div class="progressbars">
				<div class="progress" id="icmp_progress">
				</div>
			 </div>
			</div>
			
			<div class="progressbar2">
				 {{numar[2]}}/{{numar[-1]}}
				 <span style="float: left">HTTP</span>
				 <div class="progressbars">
					<div class="progress" id="http_progress">
					</div>
				 </div>
			</div>
			
			<div class="progressbar2">
				 {{numar[6]}}/{{numar[-1]}}
				 <span style="float: left">HTTPS</span>
				 <div class="progressbars">
					<div class="progress" id="https_progress">
					</div>
				 </div>
			</div>
			
			<div class="progressbar2">
				 {{numar[1]}}/{{numar[-1]}}
				 <span style="float: left">DNS</span>
				 <div class="progressbars">
					<div class="progress" id="dns_progress">
					</div>
				 </div>
			</div>
			
			<div class="progressbar2">
				 {{numar[3]}}/{{numar[-1]}}
				 <span style="float: left">VirusTotal</span>
				 <div class="progressbars">
					<div class="progress" id="vt_progress">
					</div>
				 </div>
			</div>

			<div class="progressbar2">
				 {{numar[5]}}/{{numar[-1]}}
				 <span style="float: left">Connections</span>
				 <div class="progressbars">
					<div class="progress" id="conn_progress">
					</div>
				 </div>
			</div>
			
			<div class="progressbar2">
				 {{numar[4]}}/{{numar[-1]}}
				 <span style="float: left">Listeners</span>
				 <div class="progressbars">
					<div class="progress" id="listen_progress">
					</div>
				 </div>
			</div>
			
			<div class="progressbar2">
				 {{numar[7]}}/{{numar[-1]}}
				 <span style="float: left">IPv4 Anomalies</span>
				 <div class="progressbars">
					<div class="progress" id="anomalies_progress">
					</div>
				 </div>
			</div>
			
			
		</div>
		
		
		
		
		<div class="secondfloatbox" id="second">	
			<div class="loader" id='loader'></div>
			<div class='network_box' id='network_box'>
				Network details:
			</div>
			<div class='network_box_ips' id='network_box_ips'>

			</div>

			<div class='network_most_used_ip' id='network_most_used_ip'>
				Most alerts on:
				<div class="network_most_used_ip_print" id='network_most_used_ip_print'>

				</div>
			</div>

			<div class="chart" id='chart' onmouseover="show()">
			</div>


			
		</div>




		
	</div>



</body>





	<script>
		 document.getElementById("forth").style.height =  document.getElementById("third").style.height; 
	</script>

	<script>
	var expanded = false;

	function showCheckboxes() {
		var checkboxes = document.getElementById("checkboxes");
		if (!expanded) {
			checkboxes.style.display = "block";
			expanded = true;
		} else {
			checkboxes.style.display = "none";
			expanded = false;
		}
	}
	</script>



	<script>
		document.getElementById("icmp_progress").style.width = "{{icmp}}";
		document.getElementById("http_progress").style.width = "{{http}}";
		document.getElementById("https_progress").style.width = "{{https}}";
		document.getElementById("dns_progress").style.width = "{{dns}}";
		document.getElementById("conn_progress").style.width = "{{cn}}";
		document.getElementById("listen_progress").style.width = "{{lc}}";
		document.getElementById("anomalies_progress").style.width = "{{ipv4_count}}";
		document.getElementById("vt_progress").style.width = "{{vt}}";
		document.getElementById("https_progress").style.width = "{{hsc}}";
		document.getElementById("second").style.height = document.getElementById("first").clientHeight;
		document.getElementById("third").style.marginTop  = document.getElementById("second").clientHeight;
	</script>
	
	<script>
		var ok = 0;
		function reveal(id){
			if (ok == 1){
				document.getElementById("edit").style.display = "none";
				document.getElementById("modal").style.display = "none";
				ok = 0
			}
			else if (ok == 0){
				get_edit_details(id);
				document.getElementById("edit").style.display = "block";
				document.getElementById("modal").style.display = "block";
				ok = 1
			}
		}
	</script>


	<script>
		function hide(){
				document.getElementById("edit").style.display = "none";
				document.getElementById("modal").style.display = "none";
			ok = 0;
		}
	</script>



	<script>
	function get_edit_details(id) {
		var nume="button_id=";
		var name=id;
		nume = nume.concat(name);
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var response = this.responseText;
				document.getElementById("edit_left").innerHTML = response.split("|")[0];
				document.getElementById("edit_right").innerHTML = response.split("|")[1];
			}
		};
		xhttp.open("POST", "/update_edit", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send(nume);
	}
	</script>




	<script>
	function post_edit_details_destination(id) {
		var nume="button_id=";
		var name=id;
		nume = nume.concat(name);
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var response = this.responseText;
				alert(response);
			}
		};
		xhttp.open("POST", "/edit_destionation", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send(nume);
	}
	</script>



	<script>
	function post_edit_details_payload(id) {
		var nume="button_id=";
		var name=id;
		nume = nume.concat(name);
		var xhttp = new XMLHttpRequest();
		xhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var response = this.responseText;
				alert(response);
			}
		};
		xhttp.open("POST", "/edit_payload", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send(nume);
	}
	</script>


    <script src="js/bootstrap.bundle.min.js"></script>



	<script>
		let time=2000;
		var nr1 = parseInt("{{low_risk}}");
		var count1 = document.getElementById("counter1"); 
		i=Math.floor(nr1/2);
		var intervalID = setInterval(function() { 
					if (i < nr1) { 
						i = i + 1
						count1.innerHTML=i.toString();
					} else { 
						clearInterval(intervalID); 
					} 
		        }, time/nr1); 


		var nr2 = parseInt("{{medium_risk}}");
		var count2 = document.getElementById("counter2"); 
		var j=Math.floor(nr2/2);
		var intervalID2 = setInterval(function() { 
					if (j < nr2) { 
						j = j + 1
						count2.innerHTML=j.toString();
					} else { 
						clearInterval(intervalID2); 
					} 
		        }, time/nr2); 


		var nr3 = parseInt("{{high_risk}}");
		var count3 = document.getElementById("counter3"); 
		var k=Math.floor(nr3/2);
		var intervalID3 = setInterval(function() { 
					if (k < nr3) { 
						k = k + 1
						count3.innerHTML=k.toString();
					} else { 
						clearInterval(intervalID3); 
					} 
		        }, time/nr3); 


		var nr4 = parseInt("{{whitelist_c3}}");
		var count4 = document.getElementById("counter4"); 
		var l=Math.floor(nr4/2);
		var intervalID4 = setInterval(function() { 
					if (l < nr4) { 
						l = l + 1
						count4.innerHTML=l.toString();
					} else { 
						clearInterval(intervalID4); 
					} 
		        }, time/nr4); 


		var nr5 = parseInt("{{whitelist_c2}}");
		var count5 = document.getElementById("counter5"); 
		var m=Math.floor(nr5/2);
		var intervalID5 = setInterval(function() { 
					if (m < nr5) { 
						m = m + 1
						count5.innerHTML=m.toString();
					} else { 
						clearInterval(intervalID5); 
					} 
		        }, time/nr5); 


		var nr6 = parseInt("{{whitelist_c1}}");
		var count6 = document.getElementById("counter6"); 
		var n=Math.floor(nr6/2);
		var intervalID6 = setInterval(function() { 
					if (n < nr6) { 
						n = n + 1
						count6.innerHTML=n.toString();
					} else { 
						clearInterval(intervalID6); 
					} 
		        }, time/nr6); 
	</script>



	<script>
	function sigmoid(t) {
		return 1/(1+Math.pow(Math.E, -t));
	}
	var ips;
	var count;
	var count2;
	var nume=""
	let max = 0;
	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			document.getElementById("loader").style.display="none";
			document.getElementById("chart").style.display="grid";
			document.getElementById("network_box").style.display="block";
			document.getElementById("network_box_ips").style.display="block";
			document.getElementById("network_most_used_ip").style.display="block";
			document.getElementById("network_most_used_ip_print").style.display="block";
			var response = this.responseText.split("\n");
			var array = response[0].split(' ');
			var forpage="";
			forpage=forpage.concat("IPs:<br>")
			forpage=forpage.concat("<table class='newtable'>")
			let n = 10;
			if (array.length<10){
				n = array.length;
			}
			for(let i=0; i<n; i++){
				forpage=forpage.concat("<tr class='newtr'>");
				forpage=forpage.concat("<td class='newtd'>");
				forpage=forpage.concat(array[i]);
				forpage=forpage.concat("</td>");
				forpage=forpage.concat("</tr>");
			}
			forpage=forpage.concat("</table>")
			document.getElementById("network_box_ips").innerHTML = forpage;
			var forprintips=""
			count = response[1].split(' ');
			ips = response[2].split(' ');
			for(let i=0; i<4; i++){
				forprintips=forprintips.concat(ips[i])
				forprintips=forprintips.concat("<br>")
			}
			document.getElementById("network_most_used_ip_print").innerHTML = forprintips;
			var end = 0;
			var content="";
			for(let i=0; i<ips.length; i++){
				id="bar";
				id=id.concat(i.toString());
				var name="<div class='bar' id='bar";
				name=name.concat(i.toString()+"'></div>");
				content=content.concat(name)
				//document.getElementById(id).style.gridRowEnd=(end).toString();
			}
			document.getElementById("chart").innerHTML=content;
			count2 = count.slice();
			let min = 9999;
			for (i = 0; i < count.length; i++)
			{
				if(parseFloat(count[i])>max)
				{
					max = parseFloat(count[i]);
				}
			}

			for (i = 0; i < count.length; i++)
			{
				if(parseFloat(count[i])<min)
				{
					min = parseFloat(count[i]);
				}
			}

			for (i = 0; i < count.length; i++)
			{
				var norm = 1000*(parseFloat(count[i])-min)/(max-min);
				count[i] = norm.toString();
			}
			max = 0;
			for (i = 0; i < count.length; i++)
			{
				if(parseFloat(count[i])>max)
				{
					max = parseFloat(count[i]);
				}
			}
			var procent = 100/ips.length+50;

			for(let i=0; i < ips.length; i++){
				document.getElementById("bar"+i.toString()).style.backgroundColor = 'lightblue';
				document.getElementById("bar"+i.toString()).style.width=procent.toString()+"%";
				document.getElementById("bar"+i.toString()).style.gridRowEnd=Math.ceil(max).toString();
				document.getElementById("bar"+i.toString()).style.gridRowStart=Math.ceil(max-(count[i]).toString());
				document.getElementById("bar"+i.toString()).title="Source: "+ips[i]+"\nValues: "+count2[i];
			}





		}

	};
	xhttp.open("GET", "/loadIPs", true);
	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	xhttp.send(nume);
	var ok = 0;
	function show(){
		if(ok == 0){
			ok = 1;
			for(let i=0; i < ips.length; i++){
				document.getElementById("bar"+i.toString()).style.gridRowStart="1";
				document.getElementById("bar"+i.toString()).title="Source: "+ips[i]+"\nValues: "+count2[i];
			}
			setTimeout(function(){
				var procent = 100/ips.length+50;
				for(let i=0; i < ips.length; i++){
					document.getElementById("bar"+i.toString()).style.width=procent.toString()+"%";
					document.getElementById("bar"+i.toString()).style.gridRowEnd=Math.ceil(max).toString();
					document.getElementById("bar"+i.toString()).style.gridRowStart=Math.ceil(max-(count[i]).toString());
					document.getElementById("bar"+i.toString()).title="Source: "+ips[i]+"\nValues: "+count2[i];
					ok = 0;
				}
			}, 10000);
		}
	}
	</script>




</html>